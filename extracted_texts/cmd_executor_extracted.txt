import os
import subprocess
import tempfile

def print_console_result(result):
    """ä»¥æ­£ç¡®ç¼–ç æ‰“å°æ§åˆ¶å°ç»“æœ"""
    # æ‰“å°æ‰§è¡Œç»“æœ
    if result['return_code'] == 0:
        print(f"âœ… è„šæœ¬æ‰§è¡ŒæˆåŠŸï¼")
    else:
        print(f"âŒ è„šæœ¬æ‰§è¡Œå¤±è´¥ï¼Œè¿”å›ç : {result['return_code']}")
    
    # å¤„ç†æ ‡å‡†è¾“å‡º
    if result['stdout'].strip():
        print(f"ğŸ“‹ æ ‡å‡†è¾“å‡º:")
        # é€è¡Œæ‰“å°ï¼Œé¿å…ä¸€æ¬¡æ€§è¾“å‡ºå¤§æ–‡æœ¬å¯¼è‡´çš„ç¼–ç é—®é¢˜
        for line in result['stdout'].splitlines():
            if line.strip():
                print(f"   {line}")
    
    # å¤„ç†é”™è¯¯è¾“å‡º
    if result['stderr'].strip():
        print(f"âš ï¸  é”™è¯¯è¾“å‡º:")
        for line in result['stderr'].splitlines():
            if line.strip():
                print(f"   {line}")

def execute_cmd_with_powershell(script_content, working_dir=None, timeout=300):
    """
    ä½¿ç”¨PowerShellæ‰§è¡Œcmdè„šæœ¬ï¼ˆæ›´å¥½çš„ä¸­æ–‡æ”¯æŒï¼‰
    """
    if working_dir is None:
        working_dir = os.getcwd()
    else:
        working_dir = os.path.abspath(working_dir)
        os.makedirs(working_dir, exist_ok=True)
    
    # åˆ›å»ºä¸´æ—¶batæ–‡ä»¶
    with temp